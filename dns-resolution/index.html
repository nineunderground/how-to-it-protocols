<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNS Resolution ‚Äî How-To IT Protocols</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: #0a0e17;
            color: #e0e6ed;
            min-height: 100vh;
            padding: 30px 20px;
        }
        .back { color: #7b2ff7; text-decoration: none; font-size: 0.9rem; }
        .back:hover { text-decoration: underline; }
        h1 {
            text-align: center;
            font-size: 2rem;
            margin: 20px 0 8px;
            background: linear-gradient(135deg, #00d2ff, #7b2ff7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .desc {
            text-align: center;
            color: #8892a4;
            margin-bottom: 30px;
            font-size: 0.95rem;
            max-width: 650px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Diagram */
        .canvas-wrapper { max-width: 900px; margin: 0 auto; }
        .diagram {
            position: relative;
            height: 520px;
            background: #101620;
            border: 1px solid #1e2a3a;
            border-radius: 12px;
            overflow: hidden;
        }

        /* Nodes */
        .node {
            position: absolute;
            text-align: center;
            width: 110px;
            transition: transform 0.3s, filter 0.3s;
        }
        .node.active { transform: scale(1.1); filter: brightness(1.3); }
        .node .icon { font-size: 2rem; margin-bottom: 4px; }
        .node .label { font-weight: 600; font-size: 0.82rem; }
        .node .sublabel { font-size: 0.7rem; color: #8892a4; margin-top: 2px; }
        .node .badge {
            display: inline-block;
            margin-top: 4px;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.65rem;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.4s;
        }
        .node .badge.visible { opacity: 1; }

        /* Packet */
        .packet {
            position: absolute;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            z-index: 10;
        }
        .packet.query { background: rgba(0,210,255,0.15); border: 1px solid #00d2ff; color: #00d2ff; }
        .packet.referral { background: rgba(251,191,36,0.15); border: 1px solid #fbbf24; color: #fbbf24; }
        .packet.answer { background: rgba(0,230,118,0.15); border: 1px solid #00e676; color: #00e676; }

        /* SVG lines */
        .lines-svg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;
        }
        .conn-line { stroke: #1e2a3a; stroke-width: 1; fill: none; }
        .anim-line { stroke-width: 2.5; fill: none; stroke-dasharray: 8 4; opacity: 0; }

        /* Step info */
        .step-info {
            max-width: 900px; margin: 20px auto 0;
            background: #141a26; border: 1px solid #1e2a3a; border-radius: 12px;
            padding: 24px; min-height: 120px;
        }
        .step-info h3 { font-size: 1.1rem; margin-bottom: 8px; }
        .step-info p { color: #8892a4; line-height: 1.6; font-size: 0.92rem; }
        .step-info .detail {
            margin-top: 12px; padding: 12px; background: #0a0e17; border-radius: 8px;
            font-family: 'Courier New', monospace; font-size: 0.82rem; color: #a0aec0;
            white-space: pre-wrap;
        }

        /* Controls */
        .controls {
            max-width: 900px; margin: 20px auto 0;
            display: flex; gap: 12px; justify-content: center;
        }
        button {
            padding: 10px 28px; border: 1px solid #1e2a3a; border-radius: 8px;
            background: #141a26; color: #e0e6ed; font-size: 0.95rem; cursor: pointer;
            transition: all 0.2s;
        }
        button:hover { border-color: #7b2ff7; background: #1a2236; }
        button:disabled { opacity: 0.4; cursor: not-allowed; }
        button.primary { background: #7b2ff7; border-color: #7b2ff7; color: #fff; }
        button.primary:hover { background: #6b21e8; }

        /* Try it yourself */
        .try-it { max-width: 900px; margin: 40px auto 0; }
        .try-it h2 { font-size: 1.5rem; margin-bottom: 8px; }
        .try-desc { color: #8892a4; margin-bottom: 20px; font-size: 0.92rem; }
        .terminal-tabs { display: flex; gap: 4px; }
        .tab {
            padding: 8px 20px; border: 1px solid #1e2a3a; border-bottom: none;
            border-radius: 8px 8px 0 0; background: #101620; color: #8892a4;
            cursor: pointer; font-size: 0.9rem;
        }
        .tab.active { background: #141a26; color: #e0e6ed; }
        .terminal-panel {
            background: #141a26; border: 1px solid #1e2a3a;
            border-radius: 0 12px 12px 12px; padding: 24px;
        }
        .terminal-panel.hidden { display: none; }
        .term-step { margin-bottom: 20px; }
        .term-step:last-child { margin-bottom: 0; }
        .term-badge {
            display: inline-block; padding: 3px 12px; border-radius: 12px;
            font-size: 0.78rem; font-weight: 600; margin-bottom: 8px;
        }
        .cmd-badge { background: #1f2535; color: #00d2ff; }
        .observe-badge { background: #2d2a1f; color: #fbbf24; }
        .term-block {
            background: #0a0e17; border-radius: 8px; padding: 16px; overflow-x: auto;
        }
        .term-header { font-size: 0.82rem; color: #8892a4; margin-bottom: 8px; }
        .term-block pre {
            margin: 0; font-family: 'Courier New', monospace;
            font-size: 0.85rem; line-height: 1.6; color: #e0e6ed;
        }
        .prompt { color: #4ade80; }
        .comment { color: #4a5568; }
        .term-output {
            margin-top: 8px; padding-top: 8px; border-top: 1px solid #1e2a3a;
            font-family: 'Courier New', monospace; font-size: 0.82rem; color: #8892a4;
            white-space: pre-wrap;
        }
        .term-note {
            margin-top: 16px; padding: 12px 16px;
            background: rgba(123,47,247,0.08); border-left: 3px solid #7b2ff7;
            border-radius: 0 8px 8px 0; font-size: 0.85rem; color: #a0aec0;
        }
        .term-note code {
            background: #0a0e17; padding: 2px 6px; border-radius: 4px; font-size: 0.82rem;
        }
    </style>
</head>
<body>
    <a href="../" class="back">‚Üê Back to protocols</a>
    <h1>üîç DNS Resolution</h1>
    <p class="desc">How your browser resolves a domain name like <strong>example.com</strong> into an IP address through a hierarchy of DNS servers.</p>

    <div class="canvas-wrapper">
        <div class="diagram" id="diagram">
            <svg class="lines-svg" id="lines-svg"></svg>

            <!-- Nodes -->
            <div class="node" id="node-client" style="left:30px; top:220px;">
                <div class="icon">üíª</div>
                <div class="label">Browser</div>
                <div class="sublabel">What is example.com?</div>
                <div class="badge" id="badge-client" style="background:#1f2535;color:#00d2ff;">Querying‚Ä¶</div>
            </div>
            <div class="node" id="node-resolver" style="left:210px; top:220px;">
                <div class="icon">üîÑ</div>
                <div class="label">Local Resolver</div>
                <div class="sublabel">192.168.1.1</div>
                <div class="badge" id="badge-resolver" style="background:#251f35;color:#a78bfa;">Recursive</div>
            </div>
            <div class="node" id="node-root" style="left:420px; top:40px;">
                <div class="icon">üåê</div>
                <div class="label">Root NS</div>
                <div class="sublabel">a.root-servers.net</div>
                <div class="badge" id="badge-root" style="background:#2d2a1f;color:#fbbf24;"></div>
            </div>
            <div class="node" id="node-tld" style="left:620px; top:40px;">
                <div class="icon">üè∑Ô∏è</div>
                <div class="label">.com TLD NS</div>
                <div class="sublabel">a.gtld-servers.net</div>
                <div class="badge" id="badge-tld" style="background:#2d2a1f;color:#fbbf24;"></div>
            </div>
            <div class="node" id="node-auth" style="left:720px; top:220px;">
                <div class="icon">üè¢</div>
                <div class="label">Authoritative NS</div>
                <div class="sublabel">ns1.example.com</div>
                <div class="badge" id="badge-auth" style="background:#1f2d1f;color:#4ade80;"></div>
            </div>

            <!-- Packets -->
            <div class="packet query" id="pkt-q1">A example.com?</div>
            <div class="packet query" id="pkt-q2">A example.com?</div>
            <div class="packet referral" id="pkt-r2">‚Üí ask .com TLD</div>
            <div class="packet query" id="pkt-q3">A example.com?</div>
            <div class="packet referral" id="pkt-r3">‚Üí ask ns1.example.com</div>
            <div class="packet query" id="pkt-q4">A example.com?</div>
            <div class="packet answer" id="pkt-a4">93.184.216.34</div>
            <div class="packet answer" id="pkt-a5">93.184.216.34</div>
        </div>
    </div>

    <div class="step-info" id="step-info">
        <h3>Ready to start</h3>
        <p>Click <strong>Next Step</strong> to walk through how a DNS query resolves <strong>example.com</strong> into an IP address, step by step through the DNS hierarchy.</p>
        <div class="detail">DNS uses a hierarchical system: Root ‚Üí TLD ‚Üí Authoritative nameservers.
Your local resolver does the heavy lifting (recursive resolution).</div>
    </div>

    <div class="controls">
        <button id="btn-reset" onclick="resetAnimation()">‚Ü∫ Reset</button>
        <button id="btn-next" class="primary" onclick="nextStep()">Next Step ‚Üí</button>
        <button id="btn-auto" onclick="autoPlay()">‚ñ∂ Auto Play</button>
    </div>

    <!-- Try it yourself -->
    <div class="try-it">
        <h2>üß™ Try It Yourself</h2>
        <p class="try-desc">Use these CLI tools to observe real DNS resolution on your machine.</p>

        <div class="terminal-tabs">
            <button class="tab active" onclick="switchTab('dig')">dig</button>
            <button class="tab" onclick="switchTab('nslookup')">nslookup</button>
            <button class="tab" onclick="switchTab('trace')">dig +trace</button>
        </div>

        <div class="terminal-panel" id="panel-dig">
            <div class="term-step">
                <span class="term-badge cmd-badge">Basic DNS lookup</span>
                <div class="term-block">
                    <div class="term-header">Query the A record for example.com</div>
                    <pre><code><span class="prompt">$</span> dig example.com</code></pre>
                    <div class="term-output">;; ANSWER SECTION:
example.com.        86400   IN  A   93.184.216.34

;; Query time: 23 msec
;; SERVER: 192.168.1.1#53</div>
                </div>
            </div>
            <div class="term-step">
                <span class="term-badge cmd-badge">Short format</span>
                <div class="term-block">
                    <pre><code><span class="prompt">$</span> dig +short example.com</code></pre>
                    <div class="term-output">93.184.216.34</div>
                </div>
            </div>
            <div class="term-step">
                <span class="term-badge observe-badge">Query specific record types</span>
                <div class="term-block">
                    <pre><code><span class="prompt">$</span> dig example.com AAAA   <span class="comment"># IPv6 address</span>
<span class="prompt">$</span> dig example.com MX     <span class="comment"># Mail servers</span>
<span class="prompt">$</span> dig example.com NS     <span class="comment"># Nameservers</span>
<span class="prompt">$</span> dig example.com TXT    <span class="comment"># TXT records (SPF, DKIM, etc.)</span></code></pre>
                </div>
            </div>
            <div class="term-note">
                üí° <strong>Tip:</strong> Use <code>dig @8.8.8.8 example.com</code> to query Google's public DNS instead of your local resolver.
            </div>
        </div>

        <div class="terminal-panel hidden" id="panel-nslookup">
            <div class="term-step">
                <span class="term-badge cmd-badge">Basic lookup</span>
                <div class="term-block">
                    <pre><code><span class="prompt">$</span> nslookup example.com</code></pre>
                    <div class="term-output">Server:     192.168.1.1
Address:    192.168.1.1#53

Non-authoritative answer:
Name:   example.com
Address: 93.184.216.34</div>
                </div>
            </div>
            <div class="term-step">
                <span class="term-badge cmd-badge">Query a specific DNS server</span>
                <div class="term-block">
                    <pre><code><span class="prompt">$</span> nslookup example.com 1.1.1.1</code></pre>
                    <div class="term-output">Server:     1.1.1.1
Address:    1.1.1.1#53

Non-authoritative answer:
Name:   example.com
Address: 93.184.216.34</div>
                </div>
            </div>
            <div class="term-step">
                <span class="term-badge observe-badge">Interactive mode</span>
                <div class="term-block">
                    <pre><code><span class="prompt">$</span> nslookup
> set type=MX
> example.com
<span class="comment"># Shows mail exchange records</span>
> set type=NS
> example.com
<span class="comment"># Shows authoritative nameservers</span>
> exit</code></pre>
                </div>
            </div>
            <div class="term-note">
                üí° <strong>Note:</strong> "Non-authoritative answer" means the response came from a cache, not directly from the authoritative nameserver.
            </div>
        </div>

        <div class="terminal-panel hidden" id="panel-trace">
            <div class="term-step">
                <span class="term-badge cmd-badge">Full recursive trace</span>
                <div class="term-block">
                    <div class="term-header">Watch the entire resolution path from root to answer</div>
                    <pre><code><span class="prompt">$</span> dig +trace example.com</code></pre>
                    <div class="term-output">.                   518400  IN  NS  a.root-servers.net.
.                   518400  IN  NS  b.root-servers.net.
;; Received 525 bytes from 192.168.1.1#53

com.                172800  IN  NS  a.gtld-servers.net.
com.                172800  IN  NS  b.gtld-servers.net.
;; Received 828 bytes from 198.41.0.4#53(a.root-servers.net)

example.com.        172800  IN  NS  a.iana-servers.net.
example.com.        172800  IN  NS  b.iana-servers.net.
;; Received 266 bytes from 192.5.6.30#53(a.gtld-servers.net)

example.com.        86400   IN  A   93.184.216.34
;; Received 56 bytes from 199.43.135.53#53(a.iana-servers.net)</div>
                </div>
            </div>
            <div class="term-step">
                <span class="term-badge observe-badge">Reading the trace</span>
                <div class="term-block">
                    <pre><code><span class="comment"># Each section shows one hop in the DNS hierarchy:</span>
<span class="comment"># 1. Local resolver ‚Üí Root servers (who knows .com?)</span>
<span class="comment"># 2. Root server ‚Üí .com TLD servers (who knows example.com?)</span>
<span class="comment"># 3. .com TLD ‚Üí Authoritative NS (what's the IP?)</span>
<span class="comment"># 4. Authoritative NS ‚Üí Final answer: 93.184.216.34</span></code></pre>
                </div>
            </div>
            <div class="term-note">
                üí° <strong>This is exactly what the animation above shows!</strong> <code>dig +trace</code> performs iterative resolution from your machine, bypassing the local resolver's cache.
            </div>
        </div>
    </div>

    <script>
        // Node center positions (relative to diagram)
        function getNodeCenter(id) {
            const node = document.getElementById(id);
            const diagram = document.getElementById('diagram');
            const nr = node.getBoundingClientRect();
            const dr = diagram.getBoundingClientRect();
            return {
                x: nr.left - dr.left + nr.width / 2,
                y: nr.top - dr.top + nr.height / 2
            };
        }

        // Draw static connection lines
        function drawLines() {
            const svg = document.getElementById('lines-svg');
            const pairs = [
                ['node-client', 'node-resolver'],
                ['node-resolver', 'node-root'],
                ['node-resolver', 'node-tld'],
                ['node-resolver', 'node-auth']
            ];
            let html = '';
            pairs.forEach(([a, b]) => {
                const p1 = getNodeCenter(a);
                const p2 = getNodeCenter(b);
                html += `<line class="conn-line" x1="${p1.x}" y1="${p1.y}" x2="${p2.x}" y2="${p2.y}"/>`;
            });
            svg.innerHTML = html;
        }

        // Animate a packet between two nodes
        function animatePacket(pktId, fromId, toId, duration = 1000) {
            return new Promise(resolve => {
                const pkt = document.getElementById(pktId);
                const from = getNodeCenter(fromId);
                const to = getNodeCenter(toId);
                pkt.style.transition = 'none';
                pkt.style.left = (from.x - 40) + 'px';
                pkt.style.top = (from.y - 14) + 'px';
                pkt.style.opacity = '1';
                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        pkt.style.transition = `left ${duration}ms ease-in-out, top ${duration}ms ease-in-out`;
                        pkt.style.left = (to.x - 40) + 'px';
                        pkt.style.top = (to.y - 14) + 'px';
                    });
                });
                setTimeout(() => {
                    pkt.style.opacity = '0';
                    resolve();
                }, duration + 100);
            });
        }

        function showBadge(id, text) {
            const b = document.getElementById(id);
            b.textContent = text;
            b.classList.add('visible');
        }
        function hideBadge(id) {
            document.getElementById(id).classList.remove('visible');
        }
        function highlightNode(id) {
            document.getElementById(id).classList.add('active');
        }
        function unhighlightAll() {
            document.querySelectorAll('.node').forEach(n => n.classList.remove('active'));
        }

        const steps = [
            {
                title: "Initial State",
                desc: "The browser needs to find the IP address for <strong>example.com</strong>. It has no cached result, so it will ask the local DNS resolver.",
                detail: "Browser: needs to resolve example.com\nLocal Resolver: ready (recursive resolver, e.g. your router or ISP)\nRoot NS: 13 root server clusters worldwide\n.com TLD NS: managed by Verisign\nAuthoritative NS: managed by the domain owner",
                action: async () => {
                    unhighlightAll();
                    highlightNode('node-client');
                }
            },
            {
                title: "Step 1: Browser ‚Üí Local Resolver",
                desc: "The browser sends a <strong>recursive query</strong> to the local DNS resolver: \"What is the A record for example.com?\" The resolver will do all the work.",
                detail: "DNS Query:\n  Type:   A (IPv4 address)\n  Name:   example.com\n  Flags:  RD (Recursion Desired)\n  To:     192.168.1.1:53 (UDP)\n\nThe browser only talks to the local resolver.\nThe resolver handles the full iterative lookup.",
                action: async () => {
                    unhighlightAll();
                    highlightNode('node-client');
                    highlightNode('node-resolver');
                    showBadge('badge-client', 'Querying‚Ä¶');
                    showBadge('badge-resolver', 'Received query');
                    await animatePacket('pkt-q1', 'node-client', 'node-resolver');
                }
            },
            {
                title: "Step 2: Resolver ‚Üí Root Nameserver",
                desc: "The resolver doesn't know example.com, so it starts at the top of the DNS hierarchy. It sends an <strong>iterative query</strong> to a root nameserver.",
                detail: "DNS Query ‚Üí Root NS (198.41.0.4):\n  Type:   A\n  Name:   example.com\n  Flags:  (no RD ‚Äî iterative)\n\nThere are 13 root server addresses (a‚Äìm.root-servers.net)\nbut hundreds of physical servers via anycast.",
                action: async () => {
                    unhighlightAll();
                    highlightNode('node-resolver');
                    highlightNode('node-root');
                    showBadge('badge-resolver', 'Asking root‚Ä¶');
                    await animatePacket('pkt-q2', 'node-resolver', 'node-root');
                }
            },
            {
                title: "Step 3: Root ‚Üí Referral to .com TLD",
                desc: "The root nameserver doesn't know example.com directly, but it knows who handles <strong>.com</strong>. It sends a <strong>referral</strong> to the .com TLD nameservers.",
                detail: "DNS Response from Root:\n  Status: NOERROR\n  AUTHORITY SECTION:\n    com.  172800  IN  NS  a.gtld-servers.net.\n    com.  172800  IN  NS  b.gtld-servers.net.\n  ADDITIONAL SECTION:\n    a.gtld-servers.net.  IN  A  192.5.6.30\n\n\"I don't know, but ask the .com TLD servers.\"",
                action: async () => {
                    unhighlightAll();
                    highlightNode('node-root');
                    highlightNode('node-resolver');
                    showBadge('badge-root', 'Referral ‚Üí .com');
                    await animatePacket('pkt-r2', 'node-root', 'node-resolver');
                }
            },
            {
                title: "Step 4: Resolver ‚Üí .com TLD Nameserver",
                desc: "The resolver follows the referral and asks the <strong>.com TLD nameserver</strong>: \"Who is authoritative for example.com?\"",
                detail: "DNS Query ‚Üí .com TLD (192.5.6.30):\n  Type:   A\n  Name:   example.com\n\nThe .com TLD knows all registered .com domains\nand which nameservers are authoritative for each.",
                action: async () => {
                    unhighlightAll();
                    highlightNode('node-resolver');
                    highlightNode('node-tld');
                    showBadge('badge-resolver', 'Asking .com TLD‚Ä¶');
                    hideBadge('badge-root');
                    await animatePacket('pkt-q3', 'node-resolver', 'node-tld');
                }
            },
            {
                title: "Step 5: .com TLD ‚Üí Referral to Authoritative NS",
                desc: "The .com TLD doesn't have the IP either, but it knows which nameserver is <strong>authoritative</strong> for example.com. Another referral!",
                detail: "DNS Response from .com TLD:\n  Status: NOERROR\n  AUTHORITY SECTION:\n    example.com.  172800  IN  NS  a.iana-servers.net.\n    example.com.  172800  IN  NS  b.iana-servers.net.\n  ADDITIONAL SECTION:\n    a.iana-servers.net.  IN  A  199.43.135.53\n\n\"Ask ns1.example.com ‚Äî they have the answer.\"",
                action: async () => {
                    unhighlightAll();
                    highlightNode('node-tld');
                    highlightNode('node-resolver');
                    showBadge('badge-tld', 'Referral ‚Üí auth NS');
                    await animatePacket('pkt-r3', 'node-tld', 'node-resolver');
                }
            },
            {
                title: "Step 6: Resolver ‚Üí Authoritative Nameserver",
                desc: "The resolver follows the second referral and queries the <strong>authoritative nameserver</strong> for example.com. This server has the definitive answer.",
                detail: "DNS Query ‚Üí Authoritative NS (199.43.135.53):\n  Type:   A\n  Name:   example.com\n\nThe authoritative NS is the source of truth\nfor all DNS records in the example.com zone.",
                action: async () => {
                    unhighlightAll();
                    highlightNode('node-resolver');
                    highlightNode('node-auth');
                    showBadge('badge-resolver', 'Asking auth NS‚Ä¶');
                    hideBadge('badge-tld');
                    await animatePacket('pkt-q4', 'node-resolver', 'node-auth');
                }
            },
            {
                title: "Step 7: Authoritative NS ‚Üí IP Answer",
                desc: "The authoritative nameserver responds with the <strong>actual IP address</strong>: <strong>93.184.216.34</strong>. The resolver now has the answer!",
                detail: "DNS Response from Authoritative NS:\n  Status: NOERROR\n  ANSWER SECTION:\n    example.com.  86400  IN  A  93.184.216.34\n  Flags: AA (Authoritative Answer)\n\nTTL = 86400 seconds (24 hours)\nThe resolver will cache this result.",
                action: async () => {
                    unhighlightAll();
                    highlightNode('node-auth');
                    highlightNode('node-resolver');
                    showBadge('badge-auth', '93.184.216.34');
                    await animatePacket('pkt-a4', 'node-auth', 'node-resolver');
                    showBadge('badge-resolver', 'Got answer! Caching‚Ä¶');
                }
            },
            {
                title: "Step 8: Resolver ‚Üí Browser (Final Answer)",
                desc: "The resolver sends the IP address back to the browser: <strong>93.184.216.34</strong>. The browser can now connect! The resolver caches the result for future queries (TTL: 24h).",
                detail: "DNS Response to Browser:\n  Status: NOERROR\n  ANSWER SECTION:\n    example.com.  86400  IN  A  93.184.216.34\n\n‚úÖ Resolution complete!\n   Total queries: 4 (1 recursive + 3 iterative)\n   Browser can now open a TCP connection to 93.184.216.34\n   Result cached ‚Äî next lookup will be instant.",
                action: async () => {
                    unhighlightAll();
                    highlightNode('node-resolver');
                    highlightNode('node-client');
                    hideBadge('badge-auth');
                    showBadge('badge-resolver', 'Cached ‚úì');
                    await animatePacket('pkt-a5', 'node-resolver', 'node-client');
                    showBadge('badge-client', '‚Üí 93.184.216.34 ‚úì');
                }
            }
        ];

        let currentStep = 0;
        let isAnimating = false;

        function updateInfo(step) {
            document.getElementById('step-info').innerHTML = `
                <h3>${step.title}</h3>
                <p>${step.desc}</p>
                <div class="detail">${step.detail}</div>
            `;
        }

        async function nextStep() {
            if (isAnimating || currentStep >= steps.length) return;
            isAnimating = true;
            document.getElementById('btn-next').disabled = true;
            document.getElementById('btn-auto').disabled = true;

            const step = steps[currentStep];
            updateInfo(step);
            await step.action();

            currentStep++;
            isAnimating = false;
            document.getElementById('btn-next').disabled = currentStep >= steps.length;
            document.getElementById('btn-auto').disabled = currentStep >= steps.length;
        }

        async function autoPlay() {
            while (currentStep < steps.length) {
                await nextStep();
                if (currentStep < steps.length) await new Promise(r => setTimeout(r, 800));
            }
        }

        function resetAnimation() {
            currentStep = 0;
            isAnimating = false;
            unhighlightAll();
            document.querySelectorAll('.packet').forEach(p => {
                p.style.transition = 'none';
                p.style.opacity = '0';
            });
            document.querySelectorAll('.node .badge').forEach(b => b.classList.remove('visible'));
            updateInfo(steps[0]);
            document.getElementById('btn-next').disabled = false;
            document.getElementById('btn-auto').disabled = false;
        }

        function switchTab(name) {
            document.querySelectorAll('.terminal-panel').forEach(p => p.classList.add('hidden'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById('panel-' + name).classList.remove('hidden');
            event.target.classList.add('active');
        }

        // Init
        window.addEventListener('load', () => { drawLines(); });
        window.addEventListener('resize', drawLines);
    </script>
</body>
</html>
